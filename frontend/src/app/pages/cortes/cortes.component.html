<app-sidebar></app-sidebar>

<h2 class="nome-pagina">Clipes de Falhas</h2>

<div class="container-falhas">
  <!-- FILTROS -->
  <div class="filtros">
    <div class="pesquisa">
      <i class="bi bi-search"></i>
      <input
        type="text"
        placeholder="Pesquisar por t√≠tulo ou descri√ß√£o"
        [(ngModel)]="filtroTexto"
      />
    </div>

    <div class="tipo">
      <select [(ngModel)]="filtroTipo">
        <option value="">Tipos de falha</option>
        <option *ngFor="let tipo of tiposFalha" [value]="tipo">
          {{ tipo }}
        </option>
      </select>
    </div>

    <div class="categoria">
      <select [(ngModel)]="filtroCategoria">
        <option value="">Categoria</option>
        <option *ngFor="let c of tiposCategoria" [value]="c">{{ c }}</option>
      </select>
    </div>

    <div class="severidade">
      <select [(ngModel)]="filtroSeveridade">
        <option value="">Severidade</option>
        <option *ngFor="let s of tiposSeveridade" [value]="s">{{ s }}</option>
      </select>
    </div>

    <div class="data">
      <input type="date" [(ngModel)]="filtroData" />
    </div>
  </div>

  <!-- CONTE√öDO -->
  <div class="conteudo" [class.expandido]="!falhaSelecionada">
    <!-- Lista lateral -->
    <ul class="lista-falhas">
      <li
        *ngFor="let falha of falhasFiltradas"
        (click)="selecionarFalha(falha)"
        [class.selecionada]="falha === falhaSelecionada"
      >
        <div class="icone-tipo">
          <i [class]="falha.icone" [ngStyle]="{ color: getCor(falha) }"></i>
        </div>

        <div class="conteudo-card">
          <div class="cabecalho-card">
            <strong>{{ falha.titulo }}</strong>
            <span
              class="tag-severidade"
              [ngStyle]="{ background: getCorSeveridade(falha.severidade) }"
            >
              {{ falha.severidade }}
            </span>
          </div>

          <div class="info-card">
            <span class="data-hora"
              >{{ falha.data }} | {{ falha.horario }}</span
            >
            <p class="descricao-card">
              {{ getDescricaoCurta(falha.descricao || "", 80) }}
            </p>
            <p class="categoria-card" *ngIf="falha.categoria">
              <small>{{ falha.categoria }}</small>
            </p>
          </div>

          <div class="status-card">
            <span class="tag-status" [ngClass]="{ visto: falha.seen }">
              {{ falha.seen ? "Visto" : "Pendente" }}
            </span>
            <span class="duracao">{{ falha.duracao }}</span>
          </div>
        </div>
      </li>
    </ul>

    <!-- Painel de detalhes -->
    <div class="detalhes" *ngIf="falhaSelecionada">
      <video #detailVideo controls>
        <source [src]="falhaSelecionada.videoUrl" type="video/mp4" />
        Seu navegador n√£o suporta v√≠deo.
      </video>

      <div class="info-bloco">
        <div class="header-detail">
          <h3>{{ falhaSelecionada.titulo }}</h3>
          <div class="acoes in-card">
            <button class="btn-azul" (click)="downloadClip(falhaSelecionada!)">
              ‚¨áÔ∏è Download Clipe
            </button>
            <button class="btn-verde" *ngIf="!editMode" (click)="enableEdit()">
              ‚úèÔ∏è Editar
            </button>
            <button class="btn-verde" *ngIf="editMode" (click)="saveEdit()">
              üíæ Salvar
            </button>
            <button
              class="btn-vermelho"
              *ngIf="editMode"
              (click)="cancelEdit()"
            >
              ‚úñÔ∏è Cancelar
            </button>
          </div>
        </div>

        <div *ngIf="!editMode">
          <p *ngIf="falhaSelecionada.descricao">
            <b>Descri√ß√£o:</b> {{ falhaSelecionada.descricao }}
          </p>
          <p><b>Hor√°rio:</b> {{ falhaSelecionada.horario }}</p>
          <p><b>Data:</b> {{ falhaSelecionada.dataCompleta }}</p>
          <p *ngIf="falhaSelecionada.categoria">
            <b>Categoria:</b> {{ falhaSelecionada.categoria }}
          </p>
          <p><b>Dura√ß√£o:</b> {{ falhaSelecionada.duracao }}</p>
          <p><b>Severidade:</b> {{ falhaSelecionada.severidade }}</p>
        </div>

        <div *ngIf="editMode">
          <label><b>Tipo</b></label>
          <input type="text" [(ngModel)]="editForm.type" />

          <label><b>Categoria</b></label>
          <select [(ngModel)]="editForm.category">
            <option value="">-- Selecionar --</option>
            <option *ngFor="let c of tiposCategoria" [value]="c">
              {{ c }}
            </option>
          </select>

          <label><b>Dura√ß√£o (s)</b></label>
          <input type="number" [(ngModel)]="editForm.duration_s" />

          <label><b>Severidade</b></label>
          <select [(ngModel)]="editForm.severity">
            <option value="">-- Manter/Autom√°tico --</option>
            <option *ngFor="let s of tiposSeveridade" [value]="s">
              {{ s }}
            </option>
          </select>

          <label><b>Descri√ß√£o / Observa√ß√£o</b></label>
          <textarea
            rows="5"
            [(ngModel)]="editForm.human_description"
          ></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGINA√á√ÉO -->
  <div class="paginacao-container">
    <button
      class="btn-paginacao"
      (click)="paginaAnterior()"
      [disabled]="paginaAtual === 1"
    >
      Anterior
    </button>

    <span class="pagina-info">{{ paginaAtual }} de {{ totalPaginas }}</span>

    <button
      class="btn-paginacao"
      (click)="proximaPagina()"
      [disabled]="paginaAtual === totalPaginas"
    >
      Pr√≥ximo
    </button>

    <div class="paginacao-separador">‚Ä¢</div>
    <div class="paginacao-separador">‚Ä¢</div>

    <div class="menu-itens">
      <button class="menu-btn" (click)="toggleDropdown()">
        <i class="bi bi-list"></i>
      </button>

      <div
        class="dropdown-itens"
        [style.display]="mostrarDropdown ? 'flex' : 'none'"
      >
        <label>Itens por p√°gina</label>
        <select [value]="itensPorPagina" (change)="mudarItensPorPagina($event)">
          <option [value]="10">10</option>
          <option [value]="20">20</option>
          <option [value]="50">50</option>
          <option [value]="100">100</option>
        </select>
      </div>
    </div>
  </div>
</div>
